{"paragraphs":[{"title":"1. 초기화","text":"\nimport org.json4s._\nimport org.json4s.jackson.JsonMethods._\nimport org.json4s.JsonDSL._\n\nimport org.apache.spark.sql.SparkSession\nimport org.apache.spark.sql.Encoder\n\nval bucketName=\"awskrug-data-njkwon\"\n\nval spark: SparkSession =\n    SparkSession\n        .builder()\n        .appName(\"StatsAnalyzer\")\n        .enableHiveSupport()\n        .config(\"hive.exec.dynamic.partition\", \"true\")\n        .config(\"hive.exec.dynamic.partition.mode\", \"nonstrict\")\n        .getOrCreate()","user":"anonymous","dateUpdated":"2019-09-27T00:49:34+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1569247401946_-1746285802","id":"20181009-063030_63826522","dateCreated":"2019-09-23T14:03:21+0000","dateStarted":"2019-09-26T15:16:54+0000","dateFinished":"2019-09-26T15:16:55+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:39761"},{"title":"2.Read logs file","text":"val logsDFAll = spark.read.option(\"header\",\"true\").csv(\"s3://\"+bucketName+\"/user_event_logs_2019/*/*/*.csv\")\nlogsDFAll.createOrReplaceTempView(\"logs\")\nsqlContext.cacheTable(\"logs\")","user":"anonymous","dateUpdated":"2019-09-26T15:18:07+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true,"editorHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"logsDFAll: org.apache.spark.sql.DataFrame = [timestamp: string, user_id: string ... 4 more fields]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-3-26.ap-northeast-2.compute.internal:4040/jobs/job?id=107"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1569247401953_68683240","id":"20190922-134916_924941678","dateCreated":"2019-09-23T14:03:21+0000","dateStarted":"2019-09-26T15:18:07+0000","dateFinished":"2019-09-26T15:18:08+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:39762"},{"title":"3.schema 확인","text":"logsDFAll.printSchema","user":"anonymous","dateUpdated":"2019-09-27T00:47:26+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1569301283752_-1011705203","id":"20190924-050123_1464913583","dateCreated":"2019-09-24T05:01:23+0000","dateStarted":"2019-09-26T15:18:11+0000","dateFinished":"2019-09-26T15:18:11+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:39763"},{"title":"4.데이터수 확인","text":"%sql\n\nselect count(*) \nfrom logs","user":"anonymous","dateUpdated":"2019-09-27T00:47:36+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"count(1)":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true,"editorHide":false,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1569247401954_-733451962","id":"20190720-062512_31035062","dateCreated":"2019-09-23T14:03:21+0000","dateStarted":"2019-09-26T15:18:14+0000","dateFinished":"2019-09-26T15:18:29+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:39764"},{"title":"5. Schema에 맞게 쿼리 생성","text":"%sql\nselect timestamp as base_dt,\n       user_id,\n       event_origin,\n       event_name,\n       event_goods_id,\n       event_shop_id,\n       date(timestamp) as base_date\nfrom logs\n","user":"anonymous","dateUpdated":"2019-09-27T00:47:55+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"base_dt":"string","user_id":"string","event_origin":"string","event_name":"string","event_goods_id":"string","event_shop_id":"string","base_date":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true,"editorHide":false,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1569247401954_-1588810725","id":"20190720-062707_1646973019","dateCreated":"2019-09-23T14:03:21+0000","dateStarted":"2019-09-26T15:19:02+0000","dateFinished":"2019-09-26T15:19:02+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:39765"},{"title":"6. 해당날짜 확인","text":"%sql\nselect distinct\n       date(timestamp) as base_date\nfrom logs","user":"anonymous","dateUpdated":"2019-09-27T00:48:09+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"base_date":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/sql","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1569511158951_915319634","id":"20190926-151918_233887040","dateCreated":"2019-09-26T15:19:18+0000","dateStarted":"2019-09-26T15:19:27+0000","dateFinished":"2019-09-26T15:19:29+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:39766"},{"title":"7. Glue Table 생성-Athena에서 생성가능","text":"%sql\nCREATE EXTERNAL TABLE  dw.user_event_logs\n(\n  base_dt timestamp, \n  user_id string,\n  event_origin string,\n  event_name string,\n  event_goods_id string,\n  event_shop_id string\n)\nPARTITIONED BY ( \n  base_date date )\nSTORED AS PARQUET\nLOCATION 's3://awskrug-data-njkwon/hive/dw/user_event_logs'\ntblproperties (\"parquet.compress\"=\"SNAPPY\" ,\"classification\"=\"parquet\")\n\n","user":"anonymous","dateUpdated":"2019-09-27T00:48:21+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{}},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1569247401955_1268127429","id":"20190918-072502_924581406","dateCreated":"2019-09-23T14:03:21+0000","dateStarted":"2019-09-26T15:22:32+0000","dateFinished":"2019-09-26T15:22:33+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:39767"},{"title":"8. 스키마확인","text":"%sql\nshow schemas\n","user":"anonymous","dateUpdated":"2019-09-27T00:48:59+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"databaseName":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1569247401955_208815600","id":"20190922-153245_1946100404","dateCreated":"2019-09-23T14:03:21+0000","dateStarted":"2019-09-27T00:48:37+0000","dateFinished":"2019-09-27T00:48:38+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:39768"},{"title":"9. Hive SQL - 미리 Glue에 정의를 해야 한다.","text":"sqlContext.sql(s\"\"\"\n\n    insert overwrite table  dw.user_event_logs \n    PARTITION(base_date)  \n    select timestamp as base_dt,\n           user_id,\n           event_origin,\n           event_name,\n           event_goods_id,\n           event_shop_id,\n           date(timestamp) as base_date\n    from logs\n\n\"\"\")","user":"anonymous","dateUpdated":"2019-09-27T00:49:11+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res74: org.apache.spark.sql.DataFrame = []\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-3-26.ap-northeast-2.compute.internal:4040/jobs/job?id=115"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1569247401956_-649990085","id":"20181009-235256_1693762390","dateCreated":"2019-09-23T14:03:21+0000","dateStarted":"2019-09-26T15:22:39+0000","dateFinished":"2019-09-26T15:22:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:39769"},{"title":"10. Hive 테이블에서 데이터 분석","text":"%sql\n\nselect  *\nfrom dw.user_event_logs  \n   \n","user":"anonymous","dateUpdated":"2019-09-27T00:49:19+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/sql","fontSize":9,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"base_dt":"string","user_id":"string","event_origin":"string","event_name":"string","event_goods_id":"string","event_shop_id":"string","base_date":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1569247401956_197339542","id":"20181009-063835_7872596","dateCreated":"2019-09-23T14:03:21+0000","dateStarted":"2019-09-26T15:23:43+0000","dateFinished":"2019-09-26T15:23:44+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:39770"},{"user":"anonymous","dateUpdated":"2019-09-23T14:03:21+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1569247401957_2034346444","id":"20181009-112434_452898978","dateCreated":"2019-09-23T14:03:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:39771"}],"name":"datalab-zeppelin-notebook-logs","id":"2EQPM8Y9Q","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}